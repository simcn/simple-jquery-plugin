;(function ($) {
    
    var testdata = [{"DCity":null,"ACity":null,"DepartTime":"2013-10-27","Price":0,"Rate":"0","Flight":"","AirLine":"","PriceType":""},{"DCity":null,"ACity":null,"DepartTime":"2013-10-28","Price":0,"Rate":"0","Flight":"","AirLine":"","PriceType":""},{"DCity":null,"ACity":null,"DepartTime":"2013-10-29","Price":0,"Rate":"0","Flight":"","AirLine":"","PriceType":""},{"DCity":null,"ACity":null,"DepartTime":"2013-10-30","Price":0,"Rate":"0","Flight":"","AirLine":"","PriceType":""},{"DCity":null,"ACity":null,"DepartTime":"2013-10-31","Price":0,"Rate":"0","Flight":"","AirLine":"","PriceType":""},{"DCity":null,"ACity":null,"DepartTime":"2013-11-01","Price":0,"Rate":"0","Flight":"","AirLine":"","PriceType":""},{"DCity":null,"ACity":null,"DepartTime":"2013-11-02","Price":0,"Rate":"0","Flight":"","AirLine":"","PriceType":""},{"DCity":null,"ACity":null,"DepartTime":"2013-11-03","Price":0,"Rate":"0","Flight":"","AirLine":"","PriceType":""},{"DCity":null,"ACity":null,"DepartTime":"2013-11-04","Price":0,"Rate":"0","Flight":"","AirLine":"","PriceType":""},{"DCity":"BJS","ACity":"CKG","DepartTime":"2013-11-05","Price":1110.00,"Rate":"0","Flight":"3U8834","AirLine":"3U","PriceType":"NORMALPRICE"},{"DCity":"BJS","ACity":"CKG","DepartTime":"2013-11-06","Price":1033.00,"Rate":"0","Flight":"KN5207","AirLine":"KN","PriceType":"SINGLETRIPPRICE"},{"DCity":"BJS","ACity":"CKG","DepartTime":"2013-11-07","Price":893.00,"Rate":"0","Flight":"KN5207","AirLine":"KN","PriceType":"SINGLETRIPPRICE"},{"DCity":"BJS","ACity":"CKG","DepartTime":"2013-11-08","Price":893.00,"Rate":"0","Flight":"KN5207","AirLine":"KN","PriceType":"SINGLETRIPPRICE"},{"DCity":"BJS","ACity":"CKG","DepartTime":"2013-11-09","Price":550.00,"Rate":"0","Flight":"3U8834","AirLine":"3U","PriceType":"PACKAGE"},{"DCity":"BJS","ACity":"CKG","DepartTime":"2013-11-10","Price":624.00,"Rate":"0","Flight":"3U8516","AirLine":"3U","PriceType":"SINGLETRIPPRICE"},{"DCity":"BJS","ACity":"CKG","DepartTime":"2013-11-11","Price":590.00,"Rate":"0","Flight":"CA4136","AirLine":"CA","PriceType":"NORMALPRICE"},{"DCity":"BJS","ACity":"CKG","DepartTime":"2013-11-12","Price":550.00,"Rate":"0","Flight":"3U8516","AirLine":"3U","PriceType":"PACKAGE"},{"DCity":"BJS","ACity":"CKG","DepartTime":"2013-11-13","Price":550.00,"Rate":"0","Flight":"3U8834","AirLine":"3U","PriceType":"PACKAGE"},{"DCity":"BJS","ACity":"CKG","DepartTime":"2013-11-14","Price":599.00,"Rate":"0","Flight":"CA986","AirLine":"CA","PriceType":"SINGLERULE"},{"DCity":"BJS","ACity":"CKG","DepartTime":"2013-11-15","Price":590.00,"Rate":"0","Flight":"CA986","AirLine":"CA","PriceType":"NORMALPRICE"},{"DCity":"BJS","ACity":"CKG","DepartTime":"2013-11-16","Price":590.00,"Rate":"0","Flight":"CA986","AirLine":"CA","PriceType":"NORMALPRICE"},{"DCity":"BJS","ACity":"CKG","DepartTime":"2013-11-17","Price":550.00,"Rate":"0","Flight":"3U8516","AirLine":"3U","PriceType":"PACKAGE"},{"DCity":"BJS","ACity":"CKG","DepartTime":"2013-11-18","Price":550.00,"Rate":"0","Flight":"3U8516","AirLine":"3U","PriceType":"PACKAGE"},{"DCity":"BJS","ACity":"CKG","DepartTime":"2013-11-19","Price":550.00,"Rate":"0","Flight":"3U8516","AirLine":"3U","PriceType":"PACKAGE"},{"DCity":"BJS","ACity":"CKG","DepartTime":"2013-11-20","Price":530.00,"Rate":"0","Flight":"KN5207","AirLine":"KN","PriceType":"PACKAGE"},{"DCity":"BJS","ACity":"CKG","DepartTime":"2013-11-21","Price":530.00,"Rate":"0","Flight":"KN5207","AirLine":"KN","PriceType":"PACKAGE"},{"DCity":"BJS","ACity":"CKG","DepartTime":"2013-11-22","Price":530.00,"Rate":"0","Flight":"KN5207","AirLine":"KN","PriceType":"PACKAGE"},{"DCity":"BJS","ACity":"CKG","DepartTime":"2013-11-23","Price":550.00,"Rate":"0","Flight":"CZ8129","AirLine":"CZ","PriceType":"NORMALPRICE"},{"DCity":"BJS","ACity":"CKG","DepartTime":"2013-11-24","Price":530.00,"Rate":"0","Flight":"KN5207","AirLine":"KN","PriceType":"PACKAGE"},{"DCity":"BJS","ACity":"CKG","DepartTime":"2013-11-25","Price":554.00,"Rate":"0","Flight":"3U8832","AirLine":"3U","PriceType":"SINGLETRIPPRICE"},{"DCity":"BJS","ACity":"CKG","DepartTime":"2013-11-26","Price":450.00,"Rate":"0","Flight":"KN5207","AirLine":"KN","PriceType":"PACKAGE"},{"DCity":"BJS","ACity":"CKG","DepartTime":"2013-11-27","Price":490.00,"Rate":"0","Flight":"KN5207","AirLine":"KN","PriceType":"PACKAGE"},{"DCity":"BJS","ACity":"CKG","DepartTime":"2013-11-28","Price":490.00,"Rate":"0","Flight":"KN5207","AirLine":"KN","PriceType":"PACKAGE"},{"DCity":"BJS","ACity":"CKG","DepartTime":"2013-11-29","Price":490.00,"Rate":"0","Flight":"KN5207","AirLine":"KN","PriceType":"PACKAGE"},{"DCity":"BJS","ACity":"CKG","DepartTime":"2013-11-30","Price":450.00,"Rate":"0","Flight":"KN5207","AirLine":"KN","PriceType":"PACKAGE"},{"DCity":"BJS","ACity":"CKG","DepartTime":"2013-12-01","Price":490.00,"Rate":"0","Flight":"KN5207","AirLine":"KN","PriceType":"PACKAGE"},{"DCity":"BJS","ACity":"CKG","DepartTime":"2013-12-02","Price":450.00,"Rate":"0","Flight":"KN5207","AirLine":"KN","PriceType":"PACKAGE"},{"DCity":"BJS","ACity":"CKG","DepartTime":"2013-12-03","Price":450.00,"Rate":"0","Flight":"KN5207","AirLine":"KN","PriceType":"PACKAGE"},{"DCity":"BJS","ACity":"CKG","DepartTime":"2013-12-04","Price":490.00,"Rate":"0","Flight":"KN5207","AirLine":"KN","PriceType":"PACKAGE"},{"DCity":"BJS","ACity":"CKG","DepartTime":"2013-12-05","Price":490.00,"Rate":"0","Flight":"KN5207","AirLine":"KN","PriceType":"PACKAGE"},{"DCity":"BJS","ACity":"CKG","DepartTime":"2013-12-06","Price":490.00,"Rate":"0","Flight":"KN5207","AirLine":"KN","PriceType":"PACKAGE"},{"DCity":"BJS","ACity":"CKG","DepartTime":"2013-12-07","Price":450.00,"Rate":"0","Flight":"KN5207","AirLine":"KN","PriceType":"PACKAGE"},{"DCity":"BJS","ACity":"CKG","DepartTime":"2013-12-08","Price":490.00,"Rate":"0","Flight":"KN5207","AirLine":"KN","PriceType":"PACKAGE"},{"DCity":"BJS","ACity":"CKG","DepartTime":"2013-12-09","Price":470.00,"Rate":"0","Flight":"KN5207","AirLine":"KN","PriceType":"PACKAGE"},{"DCity":"BJS","ACity":"CKG","DepartTime":"2013-12-10","Price":470.00,"Rate":"0","Flight":"KN5207","AirLine":"KN","PriceType":"PACKAGE"},{"DCity":"BJS","ACity":"CKG","DepartTime":"2013-12-11","Price":500.00,"Rate":"0","Flight":"KN5207","AirLine":"KN","PriceType":"PACKAGE"},{"DCity":"BJS","ACity":"CKG","DepartTime":"2013-12-12","Price":500.00,"Rate":"0","Flight":"KN5207","AirLine":"KN","PriceType":"PACKAGE"},{"DCity":"BJS","ACity":"CKG","DepartTime":"2013-12-13","Price":500.00,"Rate":"0","Flight":"KN5207","AirLine":"KN","PriceType":"PACKAGE"},{"DCity":"BJS","ACity":"CKG","DepartTime":"2013-12-14","Price":470.00,"Rate":"0","Flight":"KN5207","AirLine":"KN","PriceType":"PACKAGE"},{"DCity":"BJS","ACity":"CKG","DepartTime":"2013-12-15","Price":500.00,"Rate":"0","Flight":"KN5207","AirLine":"KN","PriceType":"PACKAGE"},{"DCity":"BJS","ACity":"CKG","DepartTime":"2013-12-16","Price":470.00,"Rate":"0","Flight":"KN5207","AirLine":"KN","PriceType":"PACKAGE"},{"DCity":"BJS","ACity":"CKG","DepartTime":"2013-12-17","Price":470.00,"Rate":"0","Flight":"KN5207","AirLine":"KN","PriceType":"PACKAGE"},{"DCity":"BJS","ACity":"CKG","DepartTime":"2013-12-18","Price":500.00,"Rate":"0","Flight":"KN5207","AirLine":"KN","PriceType":"PACKAGE"},{"DCity":"BJS","ACity":"CKG","DepartTime":"2013-12-19","Price":500.00,"Rate":"0","Flight":"KN5207","AirLine":"KN","PriceType":"PACKAGE"},{"DCity":"BJS","ACity":"CKG","DepartTime":"2013-12-20","Price":500.00,"Rate":"0","Flight":"KN5207","AirLine":"KN","PriceType":"PACKAGE"},{"DCity":"BJS","ACity":"CKG","DepartTime":"2013-12-21","Price":470.00,"Rate":"0","Flight":"KN5207","AirLine":"KN","PriceType":"PACKAGE"},{"DCity":"BJS","ACity":"CKG","DepartTime":"2013-12-22","Price":500.00,"Rate":"0","Flight":"KN5207","AirLine":"KN","PriceType":"PACKAGE"},{"DCity":"BJS","ACity":"CKG","DepartTime":"2013-12-23","Price":470.00,"Rate":"0","Flight":"KN5207","AirLine":"KN","PriceType":"PACKAGE"},{"DCity":"BJS","ACity":"CKG","DepartTime":"2013-12-24","Price":530.00,"Rate":"0","Flight":"KN5207","AirLine":"KN","PriceType":"SINGLETRIPPRICE"},{"DCity":"BJS","ACity":"CKG","DepartTime":"2013-12-25","Price":500.00,"Rate":"0","Flight":"KN5207","AirLine":"KN","PriceType":"PACKAGE"},{"DCity":"BJS","ACity":"CKG","DepartTime":"2013-12-26","Price":500.00,"Rate":"0","Flight":"KN5207","AirLine":"KN","PriceType":"PACKAGE"},{"DCity":"BJS","ACity":"CKG","DepartTime":"2013-12-27","Price":500.00,"Rate":"0","Flight":"KN5207","AirLine":"KN","PriceType":"PACKAGE"},{"DCity":"BJS","ACity":"CKG","DepartTime":"2013-12-28","Price":470.00,"Rate":"0","Flight":"KN5207","AirLine":"KN","PriceType":"PACKAGE"},{"DCity":"BJS","ACity":"CKG","DepartTime":"2013-12-29","Price":500.00,"Rate":"0","Flight":"KN5207","AirLine":"KN","PriceType":"PACKAGE"},{"DCity":"BJS","ACity":"CKG","DepartTime":"2013-12-30","Price":563.00,"Rate":"0","Flight":"3U8516","AirLine":"3U","PriceType":"SINGLETRIPPRICE"},{"DCity":"BJS","ACity":"CKG","DepartTime":"2013-12-31","Price":563.00,"Rate":"0","Flight":"3U8830","AirLine":"3U","PriceType":"SINGLETRIPPRICE"},{"DCity":"BJS","ACity":"CKG","DepartTime":"2014-01-01","Price":1050.00,"Rate":"0","Flight":"3U8516","AirLine":"3U","PriceType":"SINGLERULE"},{"DCity":"BJS","ACity":"CKG","DepartTime":"2014-01-02","Price":1050.00,"Rate":"0","Flight":"3U8516","AirLine":"3U","PriceType":"SINGLERULE"},{"DCity":"BJS","ACity":"CKG","DepartTime":"2014-01-03","Price":1050.00,"Rate":"0","Flight":"3U8516","AirLine":"3U","PriceType":"SINGLERULE"},{"DCity":"BJS","ACity":"CKG","DepartTime":"2014-01-04","Price":1050.00,"Rate":"0","Flight":"3U8516","AirLine":"3U","PriceType":"SINGLERULE"},{"DCity":"BJS","ACity":"CKG","DepartTime":"2014-01-05","Price":1050.00,"Rate":"0","Flight":"3U8516","AirLine":"3U","PriceType":"SINGLERULE"},{"DCity":"BJS","ACity":"CKG","DepartTime":"2014-01-06","Price":1090.00,"Rate":"0","Flight":"3U8516","AirLine":"3U","PriceType":"NORMALPRICE"},{"DCity":"BJS","ACity":"CKG","DepartTime":"2014-01-07","Price":1050.00,"Rate":"0","Flight":"3U8516","AirLine":"3U","PriceType":"SINGLERULE"},{"DCity":"BJS","ACity":"CKG","DepartTime":"2014-01-08","Price":1050.00,"Rate":"0","Flight":"3U8516","AirLine":"3U","PriceType":"SINGLERULE"},{"DCity":"BJS","ACity":"CKG","DepartTime":"2014-01-09","Price":1050.00,"Rate":"0","Flight":"3U8516","AirLine":"3U","PriceType":"SINGLERULE"},{"DCity":"BJS","ACity":"CKG","DepartTime":"2014-01-10","Price":1050.00,"Rate":"0","Flight":"3U8516","AirLine":"3U","PriceType":"SINGLERULE"},{"DCity":"BJS","ACity":"CKG","DepartTime":"2014-01-11","Price":1210.00,"Rate":"0","Flight":"3U8516","AirLine":"3U","PriceType":"SINGLERULE"},{"DCity":"BJS","ACity":"CKG","DepartTime":"2014-01-12","Price":1210.00,"Rate":"0","Flight":"3U8516","AirLine":"3U","PriceType":"SINGLERULE"},{"DCity":"BJS","ACity":"CKG","DepartTime":"2014-01-13","Price":1210.00,"Rate":"0","Flight":"3U8516","AirLine":"3U","PriceType":"SINGLERULE"},{"DCity":"BJS","ACity":"CKG","DepartTime":"2014-01-14","Price":1210.00,"Rate":"0","Flight":"3U8516","AirLine":"3U","PriceType":"SINGLERULE"},{"DCity":"BJS","ACity":"CKG","DepartTime":"2014-01-15","Price":1250.00,"Rate":"0","Flight":"3U8516","AirLine":"3U","PriceType":"NORMALPRICE"},{"DCity":"BJS","ACity":"CKG","DepartTime":"2014-01-16","Price":1433.00,"Rate":"0","Flight":"KN5207","AirLine":"KN","PriceType":"NORMALPRICE"},{"DCity":"BJS","ACity":"CKG","DepartTime":"2014-01-17","Price":1433.00,"Rate":"0","Flight":"KN5207","AirLine":"KN","PriceType":"NORMALPRICE"},{"DCity":"BJS","ACity":"CKG","DepartTime":"2014-01-18","Price":1435.00,"Rate":"0","Flight":"CA4144","AirLine":"CA","PriceType":"NORMALPRICE"},{"DCity":"BJS","ACity":"CKG","DepartTime":"2014-01-19","Price":1433.00,"Rate":"0","Flight":"KN5207","AirLine":"KN","PriceType":"NORMALPRICE"},{"DCity":"BJS","ACity":"CKG","DepartTime":"2014-01-20","Price":1433.00,"Rate":"0","Flight":"KN5207","AirLine":"KN","PriceType":"NORMALPRICE"},{"DCity":"BJS","ACity":"CKG","DepartTime":"2014-01-21","Price":1433.00,"Rate":"0","Flight":"KN5207","AirLine":"KN","PriceType":"NORMALPRICE"},{"DCity":"BJS","ACity":"CKG","DepartTime":"2014-01-22","Price":1433.00,"Rate":"0","Flight":"KN5207","AirLine":"KN","PriceType":"NORMALPRICE"},{"DCity":"BJS","ACity":"CKG","DepartTime":"2014-01-23","Price":1433.00,"Rate":"0","Flight":"KN5207","AirLine":"KN","PriceType":"NORMALPRICE"},{"DCity":"BJS","ACity":"CKG","DepartTime":"2014-01-24","Price":1433.00,"Rate":"0","Flight":"KN5207","AirLine":"KN","PriceType":"NORMALPRICE"},{"DCity":"BJS","ACity":"CKG","DepartTime":"2014-01-25","Price":1560.00,"Rate":"0","Flight":"CA1439","AirLine":"CA","PriceType":"NORMALPRICE"},{"DCity":"BJS","ACity":"CKG","DepartTime":"2014-01-26","Price":1449.00,"Rate":"0","Flight":"CZ8129","AirLine":"CZ","PriceType":"SINGLETRIPPRICE"},{"DCity":"BJS","ACity":"CKG","DepartTime":"2014-01-27","Price":1449.00,"Rate":"0","Flight":"CZ8129","AirLine":"CZ","PriceType":"SINGLETRIPPRICE"},{"DCity":"BJS","ACity":"CKG","DepartTime":"2014-01-28","Price":1449.00,"Rate":"0","Flight":"CZ8129","AirLine":"CZ","PriceType":"SINGLETRIPPRICE"},{"DCity":"BJS","ACity":"CKG","DepartTime":"2014-01-29","Price":1449.00,"Rate":"0","Flight":"CZ8129","AirLine":"CZ","PriceType":"SINGLETRIPPRICE"},{"DCity":"BJS","ACity":"CKG","DepartTime":"2014-01-30","Price":1449.00,"Rate":"0","Flight":"CZ8129","AirLine":"CZ","PriceType":"SINGLETRIPPRICE"},{"DCity":"BJS","ACity":"CKG","DepartTime":"2014-01-31","Price":1449.00,"Rate":"0","Flight":"CZ8129","AirLine":"CZ","PriceType":"SINGLETRIPPRICE"},{"DCity":"BJS","ACity":"CKG","DepartTime":"2014-02-01","Price":910.00,"Rate":"0","Flight":"3U8832","AirLine":"3U","PriceType":"SINGLERULE"},{"DCity":"BJS","ACity":"CKG","DepartTime":"2014-02-02","Price":910.00,"Rate":"0","Flight":"3U8832","AirLine":"3U","PriceType":"SINGLERULE"}];
    
    
    /**
     * tabs组件
     * @returns this;
     */
    $.fn.gs_calendar_table = function (opts) {
        
        opts = $.extend({
             'title': '> .calendar_table_title'
            ,'frame': '> .calendar_table_frame'
            ,'next': '> .calendar_control_next'
            ,'prev': '> .calendar_control_prev'
            ,'callback':''
        }, opts);
        
        var $this = $(this),
            $title = $this.find(opts.title),
            $frame = $this.find(opts.frame),
            $next = $this.find(opts.next),
            $prev = $this.find(opts.prev);
            
        var now = new Date(),
            today = new Date(now.getFullYear(), now.getMonth(), now.getDate()),
            year = now.getFullYear(),
            month = now.getMonth()+1,
            day = now.getDate();
        
        var ymd = function(d){
            var dd = $.trim(d).split('-');
            return {y:dd[0],m:dd[1],d:dd[2]}            
        }
        
        //按日期分组数据
        var formatDate = function(){
            var caldata = {},j=0;
            for(var i=0; i<testdata.length; i++){
                var key = testdata[i].DepartTime.substr(0,7);
                if (caldata[key]==undefined) {
                    caldata[key] = [];
                }
                caldata[key].push(testdata[i]);
            }
            return caldata;
        }
        
        var newCal = formatDate();
        
        
        
        var init = function(){
            var html = [], i=0;
            
            for(i in newCal){
                console.log(newCal[i]);
                console.log(i);
                //html.push('<span>'+testdata[i].DepartTime+'</span>');
            }
            
            
            html.join('');
            $frame.html($(html.join('')));
        }
        
        init();
        
        
        return this;
        
    }
    
})(window.jQuery);